# AtomicHabits

:calendar: В 2018 году Джеймс Клир написал книгу «Атомные привычки», которая посвящена приобретению новых полезных привычек и искоренению старых плохих привычек. Данное приложение предназначено для создания напоминаний о нужных привычках и их отправке пользователю через telegram.
Приложение реализует механизм CRUD для сущности "Привычка", позволяет регистрировать пользователей и отправлять напоминания в telegram.
---------------------------------------------

Сервис использует:
 - PostgreSQL база данных для проекта;
 - Celery, Celery-beat для выполнения различных периодических задач отправки оповещений,
 - Redis - NoSQL базу данных для обеспечения работы Celery с периодическими задачами.

## Инструкция для запуска вручную (через консоль): ⌨️

:clipboard: Для использования приложения следует выполнить ряд инструкций:
1. Клонировать проект
2. Установить PostgreSQL, Celery, Celery-beat и Redis
3. Установить и активировать виртуальное окружение для проекта
4. Установить зависимости из файла *requirements.txt* или *pyproject.toml*
5. Создать базу данных в **postgres** и внести требуемые настройки в файл *.env* (пример *.env.sample*)
6. Создать своего телеграм-бота (для этого нужно перейти по [ссылке](https://t.me/BotFather))
7. Записать токен своего бота в файл *.env*
8. Провести миграции `python manage.py migrate`
9. Создать суперюзера для возможности администрирования при помощи команды `python manage.py createadmin`
10. Запустить сервер `python manage.py runserver`
11. Запустить главную функцию в файле *telegram-bot/telegram_bot.py*
12. Запустить в консоли обработчика задач (worker) и планировщика задач:
    + `celery -A config worker --loglevel=info`
    + `celery -A config beat -l info --scheduler django_celery_beat.schedulers:DatabaseScheduler`

Для того, чтобы пользователь смог получать уведомления в telegram, он должен начать диалог с созданным ботом через команду /start в соответствующем чате. 
После этого он может создавать привычки с требуемой периодичностью напоминания и получать уведомления, когда придет время выполнить действие. 



## Инструкции для запуска через Docker :whale2:

### Настройки окружения
Для успешного запуска проекта необходимо предоставить файл `.env.docker` (файл-образец .env.docker.sample).
Перед началом работы следует заполнить значения для описанных переменных согласно потребностям и требованиям проекта.

### Структура проекта
Структура проекта включает в себя следующие ключевые файлы и каталоги:

- `.env.docker.sample`: Образец файла `.env.docker` с переменными окружения. Необходимо создать отдельный файл `.env.docker` на основе этого образца и заполнить значения.

- `Dockerfile`: Файл Dockerfile для сборки контейнера приложения.

- `docker-compose.yaml`: Файл конфигурации Docker Compose, который определяет контейнеры и их зависимости.
  
- `requirements.txt`: Файл, содержащий информацию о зависимостях, которые должны быть установлены при запуске контейнера.

### Docker-контейнеры
Проект использует Docker для упаковки приложения и его зависимостей в контейнеры:

1. `redis`: Контейнер с Redis, который используется в качестве брокера для Celery.

2. `postgres_db`: Контейнер с PostgreSQL для хранения данных приложения. Параметры PostgreSQL определены в файле `.env.docker`.

3. `app`: Контейнер для приложения Django.
   
4. `celery`: Контейнер для выполнения задач в фоновом режиме с использованием Celery.

5. `celery-beat`: Контейнер для выполнения периодических задач с использованием Celery Beat.

### Запуск проекта
Чтобы запустить проект через Docker требуется:
1. Клонировать этот репозиторий.
   
2. Скопировать переменные из `.env.docker.sample` в `.env.docker` и установить необходимые значения переменных окружения, как описано в разделе "Настройки окружения".

3. Убедиться, что установлены Docker и Docker Compose.

4. В командной строке выполнить команду:
`docker-compose up --build`


:shipit:
